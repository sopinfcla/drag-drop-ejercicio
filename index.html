<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordena las frases correctamente</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #f2f7ff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h2 {
            color: #2d87f0;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 30px;
        }
        .puntuacion {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
        .estrellas {
            display: flex;
            margin: 0 15px;
        }
        .estrella {
            width: 30px;
            height: 30px;
            margin: 0 3px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ddd"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>');
            background-repeat: no-repeat;
            transition: all 0.3s ease;
        }
        .estrella.activa {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FFD700"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>');
            transform: scale(1.2);
        }
        .motivacion {
            font-size: 18px;
            font-style: italic;
            color: #555;
            margin: 15px 0;
            padding: 10px;
            background-color: #e6f2ff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .motivacion-emoji {
            font-size: 24px;
            margin-right: 10px;
        }
        .zona-drop {
            min-height: 80px;
            width: 100%;
            padding: 15px;
            margin: 0 auto 20px auto;
            background-color: white;
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            border-radius: 12px;
            border: 2px dashed #2d87f0;
            background-image: linear-gradient(transparent 24px, #ddd 25px), 
                             linear-gradient(to right, transparent 24px, #ddd 25px);
            background-size: 25px 25px;
            transition: all 0.3s ease;
        }
        .zona-drop.correcta {
            border: 2px solid #4CAF50;
            background-image: none;
            background-color: rgba(76, 175, 80, 0.1);
            pointer-events: none; /* Bloquear interacci√≥n cuando es correcta */
        }
        .palabra {
            display: inline-block;
            padding: 10px 15px;
            margin: 5px;
            background-color: #2d87f0;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .palabra:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .palabra.arrastrando {
            opacity: 0.5;
        }
        .palabra.correcta {
            background-color: #4CAF50;
        }
        .palabra.incorrecta {
            background-color: #f44336;
        }
        /* Colores para las palabras colocadas en la zona drop */
        .palabra-colocada {
            background-color: #FF9800;
        }
        .frases-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        .frase {
            margin-bottom: 40px;
            width: 100%;
            opacity: 1;
            transition: all 0.5s ease;
        }
        .frase.completada {
            animation: frase-completada 1s ease;
        }
        @keyframes frase-completada {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .palabras-desordenadas {
            min-height: 60px;
            padding: 15px;
            background-color: rgba(45, 135, 240, 0.1);
            border-radius: 12px;
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .botones-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            margin: 10px;
            background-color: #2d87f0;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
        }
        button:hover {
            background-color: #1a76d2;
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button .icono {
            margin-right: 8px;
            font-size: 20px;
        }
        .instruccion {
            color: #444;
            font-style: italic;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .instruccion:before {
            content: "üìù";
            margin-right: 8px;
            font-size: 20px;
        }
        .resultado {
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            display: none;
            animation: aparecer 0.5s ease;
        }
        @keyframes aparecer {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .correcto {
            background-color: rgba(76, 175, 80, 0.2);
            color: #2e7d32;
        }
        .incorrecto {
            background-color: rgba(244, 67, 54, 0.2);
            color: #c62828;
        }
        .inicio {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            animation: aparecer-inicio 1s ease;
        }
        @keyframes aparecer-inicio {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        input[type="text"] {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 30px;
            font-size: 16px;
            outline: none;
            width: 80%;
            margin: 15px auto;
            transition: all 0.3s ease;
        }
        input[type="text"]:focus {
            border-color: #2d87f0;
            box-shadow: 0 0 8px rgba(45, 135, 240, 0.3);
        }
        .nivel {
            margin-top: 20px;
            display: none;
        }
        .nivel-label {
            margin-right: 10px;
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            color: #555;
        }
        .nivel-btns {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }
        .nivel-btn {
            padding: 10px 20px;
            margin: 0 8px;
            background-color: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .nivel-btn.seleccionado {
            background-color: #2d87f0;
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(45, 135, 240, 0.3);
        }
        .nivel-descripcion {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 10px;
            text-align: left;
        }
        .progreso {
            width: 100%;
            height: 10px;
            background-color: #ddd;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .barra-progreso {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.5s ease;
        }
        .nombre-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        .nombre-label {
            font-weight: bold;
            margin-right: 10px;
            color: #555;
        }
        /* Estilo para niveles alcanzados */
        .nivel-alcanzado {
            font-size: 16px;
            color: #2d87f0;
            margin-top: 10px;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .puntuacion {
                flex-direction: column;
            }
            .estrellas {
                margin: 10px 0;
            }
            button {
                padding: 10px 15px;
                font-size: 14px;
            }
            .palabra {
                padding: 8px 12px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <h2>Ordena todas las frases correctamente</h2>
    <div class="inicio" id="pantalla-inicio">
        <div class="nombre-container">
            <span class="nombre-label">Tu Nombre:</span>
            <input type="text" id="nombre" placeholder="Escribe tu nombre">
        </div>
        <div class="nivel">
            <span class="nivel-label">Elige tu nivel:</span>
            <div class="nivel-btns">
                <button class="nivel-btn seleccionado" data-nivel="facil">F√°cil</button>
                <button class="nivel-btn" data-nivel="medio">Medio</button>
                <button class="nivel-btn" data-nivel="dificil">Dif√≠cil</button>
            </div>
            <div class="nivel-descripcion">
                <strong>F√°cil:</strong> Frases cortas y simples con 4-5 palabras<br>
                <strong>Medio:</strong> Frases de longitud media con 6-7 palabras<br>
                <strong>Dif√≠cil:</strong> Frases largas y complejas con 8-10 palabras
            </div>
        </div>
        <button onclick="iniciarJuego()"><span class="icono">üéÆ</span> ¬°Comenzar!</button>
    </div>

    <div class="puntuacion" style="display: none;">
        <div>
            Puntos: <span id="puntos">0</span> / <span id="total-frases">0</span>
        </div>
        <div class="estrellas" id="estrellas">
            <div class="estrella" id="estrella-1"></div>
            <div class="estrella" id="estrella-2"></div>
            <div class="estrella" id="estrella-3"></div>
            <div class="estrella" id="estrella-4"></div>
            <div class="estrella" id="estrella-5"></div>
        </div>
        <div class="nivel-alcanzado" id="nivel-alcanzado">
            Nivel: Principiante
        </div>
    </div>
    
    <div class="motivacion" id="motivacion" style="display: none;">
        <span class="motivacion-emoji">üéÆ</span>
        <span id="texto-motivacion">¬°Vamos a jugar!</span>
    </div>

    <div id="frases-container" class="frases-container" style="display: none;"></div>
    
    <div class="botones-container" style="display: none;" id="botones-container">
        <button onclick="verificarTodas()"><span class="icono">‚úÖ</span> Verificar todas</button>
        <button onclick="nuevaRonda()"><span class="icono">üîÑ</span> Nueva Ronda</button>
    </div>

    <script>
        // Variables globales
        let frases = [];
        let frasesMotivadoras = [];
        let jugador = "";
        let puntuacion = 0;
        let puntuacionTotal = 0;
        let nivelActual = "facil";
        let frasesCompletadas = new Set(); // Para rastrear frases ya completadas correctamente
        let frasesBloqueadas = new Set(); // Para rastrear frases ya verificadas en la ronda actual
        let totalRondas = 0;
        
        // Configuraci√≥n por nivel
        const nivelesConfig = {
            "facil": {
                minPalabras: 4,
                maxPalabras: 5,
                totalFrases: 5,
                puntosParaEstrella: 5 // Puntos necesarios para cada estrella
            },
            "medio": {
                minPalabras: 6,
                maxPalabras: 7,
                totalFrases: 5,
                puntosParaEstrella: 10
            },
            "dificil": {
                minPalabras: 8,
                maxPalabras: 10,
                totalFrases: 5,
                puntosParaEstrella: 15
            }
        };

        // Niveles alcanzados basados en estrellas
        const nivelesAlcanzados = [
            "Principiante", // 0-1 estrellas
            "Aprendiz",     // 2 estrellas
            "Aventajado",   // 3 estrellas
            "Experto",      // 4 estrellas
            "Maestro"       // 5 estrellas
        ];

        // Emojis para frases motivadoras
        const emojisMotivadores = ["üéÆ", "üèÜ", "üåü", "üöÄ", "üéØ", "üî•", "üí™", "üéâ", "üåà", "ü¶Ñ"];
        
        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // Mostrar los botones de nivel al cargar la p√°gina
            document.querySelector('.nivel').style.display = "block";
            
            // Configurar los botones de nivel
            document.querySelectorAll('.nivel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Quitar la clase seleccionado de todos los botones
                    document.querySelectorAll('.nivel-btn').forEach(b => b.classList.remove('seleccionado'));
                    // Agregar la clase seleccionado al bot√≥n clickeado
                    this.classList.add('seleccionado');
                    // Actualizar nivel actual
                    nivelActual = this.getAttribute('data-nivel');
                });
            });
        });
        
        // Funci√≥n para iniciar el juego
        function iniciarJuego() {
            jugador = document.getElementById("nombre").value.trim();
            if (!jugador) jugador = "Jugador";
            
            // Ocultar pantalla de inicio
            document.getElementById("pantalla-inicio").style.display = "none";
            
            // Mostrar elementos del juego
            document.querySelector(".puntuacion").style.display = "flex";
            document.getElementById("motivacion").style.display = "flex";
            document.getElementById("frases-container").style.display = "block";
            document.getElementById("botones-container").style.display = "flex";
            
            // Mostrar total de frases
            document.getElementById("total-frases").textContent = nivelesConfig[nivelActual].totalFrases;
            
            // Cargar datos necesarios
            cargarFrasesMotivadoras();
            cargarFrases();
            
            // Actualizar estrellas
            actualizarEstrellas();
        }
        
        // Funci√≥n para cargar frases motivadoras
        async function cargarFrasesMotivadoras() {
            try {
                // Simular carga desde archivo para compatibilidad
                frasesMotivadoras = [
                    "¬°Nunca te rindas! Mickey Mouse dice que la magia est√° en ti. üê≠‚ú®",
                    "¬°Sigue adelante! Elsa te recuerda que 'El fr√≠o nunca te molest√≥'. ‚ùÑÔ∏èüëë",
                    "¬°Hulk dice que eres incre√≠blemente fuerte! üí™üî•",
                    "¬°Spiderman cree que tienes reflejos de h√©roe! üï∑Ô∏èü¶∏‚Äç‚ôÇÔ∏è",
                    "¬°Bluey quiere jugar contigo para celebrar tu esfuerzo! üê∂üíô",
                    "¬°Eres un campe√≥n! Capit√°n Am√©rica te saluda. üá∫üá∏ü¶∏‚Äç‚ôÇÔ∏è",
                    "¬°Tu cerebro brilla como la estrella de la Bella y la Bestia! üåüüìñ",
                    "¬°Buzz Lightyear te dice: 'Al infinito y m√°s all√°'! üöÄ",
                    "¬°Sigue as√≠! Olaf te da un abrazo calentito. ‚õÑüíô",
                    "¬°Harry Potter te anima a seguir aprendiendo! üìñüßô‚Äç‚ôÇÔ∏è",
                    "¬°Super Mario dice que est√°s alcanzando la bandera! üèÅüçÑ",
                    "¬°Como dice Dory, sigue nadando, sigue nadando! üê†üí¶",
                    "¬°Iron Man est√° impresionado con tu inteligencia! ü¶æ‚ö°",
                    "¬°La Princesa Leia dice que la fuerza est√° contigo! ‚ú®‚≠ê",
                    "¬°Sonic piensa que eres s√∫per r√°pido ordenando frases! ü¶îüí®"
                ];
                
                mostrarFraseMotivadora();
            } catch (error) {
                console.error("Error al cargar las frases motivadoras:", error);
                frasesMotivadoras = [
                    "¬°Sigue as√≠, vas muy bien!",
                    "¬°Conf√≠a en ti, puedes lograrlo!",
                    "¬°Cada intento te acerca m√°s al √©xito!"
                ];
                mostrarFraseMotivadora();
            }
        }
        
        // Funci√≥n para mostrar una frase motivadora aleatoria
        function mostrarFraseMotivadora() {
            if (frasesMotivadoras.length === 0) return;
            
            let frase = frasesMotivadoras[Math.floor(Math.random() * frasesMotivadoras.length)];
            // Reemplazar {jugador} con el nombre del jugador
            frase = frase.replace("{jugador}", jugador);
            
            // Actualizar texto y emoji
            document.getElementById("texto-motivacion").textContent = frase;
            const emoji = emojisMotivadores[Math.floor(Math.random() * emojisMotivadores.length)];
            document.querySelector(".motivacion-emoji").textContent = emoji;
        }
        
        // Funci√≥n para cargar las frases a ordenar
        async function cargarFrases() {
            try {
                // Simulamos la carga de frases desde el archivo
                const ejemploFrases = [
                    {
                        "palabras": ["Los", "dinosaurios", "vivieron", "hace", "millones", "de", "a√±os"],
                        "orden_correcto": ["Los", "dinosaurios", "vivieron", "hace", "millones", "de", "a√±os"]
                    },
                    {
                        "palabras": ["Bingo", "y", "Bluey", "juegan", "con", "su", "pap√°"],
                        "orden_correcto": ["Bingo", "y", "Bluey", "juegan", "con", "su", "pap√°"]
                    },
                    {
                        "palabras": ["En", "Segovia", "hace", "fr√≠o", "y", "nieva", "en", "invierno"],
                        "orden_correcto": ["En", "Segovia", "hace", "fr√≠o", "y", "nieva", "en", "invierno"]
                    },
                    {
                        "palabras": ["La", "Sagrada", "Familia", "est√°", "en", "Barcelona"],
                        "orden_correcto": ["La", "Sagrada", "Familia", "est√°", "en", "Barcelona"]
                    },
                    {
                        "palabras": ["Los", "coches", "circulan", "por", "la", "carretera"],
                        "orden_correcto": ["Los", "coches", "circulan", "por", "la", "carretera"]
                    },
                    {
                        "palabras": ["Las", "ardillas", "comen", "bellotas", "en", "el", "bosque"],
                        "orden_correcto": ["Las", "ardillas", "comen", "bellotas", "en", "el", "bosque"]
                    },
                    {
                        "palabras": ["Los", "castillos", "tienen", "torres", "y", "murallas"],
                        "orden_correcto": ["Los", "castillos", "tienen", "torres", "y", "murallas"]
                    },
                    {
                        "palabras": ["Los", "superh√©roes", "de", "Marvel", "luchan", "contra", "el", "mal"],
                        "orden_correcto": ["Los", "superh√©roes", "de", "Marvel", "luchan", "contra", "el", "mal"]
                    },
                    {
                        "palabras": ["Los", "ping√ºinos", "viven", "en", "el", "Polo", "Sur"],
                        "orden_correcto": ["Los", "ping√ºinos", "viven", "en", "el", "Polo", "Sur"]
                    },
                    {
                        "palabras": ["Los", "unicornios", "son", "m√°gicos", "y", "tienen", "un", "cuerno"],
                        "orden_correcto": ["Los", "unicornios", "son", "m√°gicos", "y", "tienen", "un", "cuerno"]
                    },
                    {
                        "palabras": ["Mickey", "Mouse", "lleva", "pantalones", "rojos"],
                        "orden_correcto": ["Mickey", "Mouse", "lleva", "pantalones", "rojos"]
                    },
                    {
                        "palabras": ["En", "primavera", "las", "flores", "crecen", "y", "los", "p√°jaros", "cantan"],
                        "orden_correcto": ["En", "primavera", "las", "flores", "crecen", "y", "los", "p√°jaros", "cantan"]
                    },
                    {
                        "palabras": ["El", "acueducto", "de", "Segovia", "es", "muy", "antiguo"],
                        "orden_correcto": ["El", "acueducto", "de", "Segovia", "es", "muy", "antiguo"]
                    },
                    {
                        "palabras": ["En", "verano", "vamos", "a", "la", "playa", "y", "nadamos", "en", "el", "mar"],
                        "orden_correcto": ["En", "verano", "vamos", "a", "la", "playa", "y", "nadamos", "en", "el", "mar"]
                    },
                    {
                        "palabras": ["El", "oto√±o", "tiene", "hojas", "de", "colores", "y", "viento", "fresco"],
                        "orden_correcto": ["El", "oto√±o", "tiene", "hojas", "de", "colores", "y", "viento", "fresco"]
                    }
                ];
                
                frases = ejemploFrases;
                generarFrases();
            } catch (error) {
                console.error("Error al cargar las frases:", error);
                alert("Hubo un error al cargar las frases. Por favor, recarga la p√°gina.");
            }
        }
        
        // Funci√≥n para filtrar frases seg√∫n nivel de dificultad
        function filtrarFrasesPorNivel(frases, nivel) {
            const config = nivelesConfig[nivel];
            return frases.filter(frase => {
                const numPalabras = frase.palabras.length;
                return numPalabras >= config.minPalabras && numPalabras <= config.maxPalabras;
            });
        }
        
        // Funci√≥n para generar las frases en el DOM
        function generarFrases() {
            const contenedor = document.getElementById("frases-container");
            contenedor.innerHTML = "";
            
            // Reiniciar frases bloqueadas para la nueva ronda
            frasesBloqueadas = new Set();
            
            // Filtrar frases seg√∫n nivel y seleccionar cantidad necesaria
            const frasesFiltradas = filtrarFrasesPorNivel(frases, nivelActual);
            // Excluir frases ya completadas si es posible
            const frasesDisponibles = frasesFiltradas.filter((_, index) => !frasesCompletadas.has(index));
            
            // Si no hay suficientes frases disponibles, resetear las completadas
            if (frasesDisponibles.length < nivelesConfig[nivelActual].totalFrases) {
                frasesCompletadas.clear();
            }
            
            // Seleccionar frases aleatorias
            const frasesAleatorias = obtenerFrasesAleatorias(
                frasesDisponibles.length > 0 ? frasesDisponibles : frasesFiltradas, 
                nivelesConfig[nivelActual].totalFrases
            );
            
            // Incrementar contador de rondas
            totalRondas++;
            
            // Para cada frase, creamos su contenedor y elementos
            frasesAleatorias.forEach((frase, index) => {
                const fraseDiv = document.createElement("div");
                fraseDiv.className = "frase";
                fraseDiv.id = `frase-${index}`;
                fraseDiv.dataset.fraseIndice = index; // Guardar √≠ndice de la frase
                fraseDiv.innerHTML = `
                    <div class="instruccion">Ordena esta frase:</div>
                    <div class="zona-drop" id="zona-drop-${index}" data-index="${index}"></div>
                    <div class="palabras-desordenadas" id="palabras-${index}"></div>
                    <div class="resultado" id="resultado-${index}"></div>
                `;
                contenedor.appendChild(fraseDiv);
                
                // Crear palabras desordenadas
                const palabrasDesordenadas = [...frase.palabras];
                mezclarArray(palabrasDesordenadas);
                
                const palabrasContainer = document.getElementById(`palabras-${index}`);
                palabrasDesordenadas.forEach((palabra, i) => {
                    const palabraSpan = document.createElement("div");
                    palabraSpan.className = "palabra";
                    palabraSpan.textContent = palabra;
                    palabraSpan.draggable = true;
                    palabraSpan.dataset.index = index;
                    palabraSpan.dataset.palabra = palabra;
                    palabraSpan.addEventListener("dragstart", dragStart);
                    palabraSpan.addEventListener("dragend", dragEnd);
                    palabraSpan.addEventListener("click", clickPalabra);
                    palabrasContainer.appendChild(palabraSpan);
                });
                
                // Configurar la zona de destino
                const zonaDestino = document.getElementById(`zona-drop-${index}`);
                zonaDestino.addEventListener("dragover", dragOver);
                zonaDestino.addEventListener("dragenter", dragEnter);
                zonaDestino.addEventListener("dragleave", dragLeave);
                zonaDestino.addEventListener("drop", drop);
                zonaDestino.addEventListener("click", clickZonaDestino);
            });
            
            // Mostrar nueva frase motivadora para la nueva ronda
            mostrarFraseMotivadora();
        }
        
        // Funci√≥n para obtener frases aleatorias del array
        function obtenerFrasesAleatorias(array, cantidad) {
            const arrayCopia = [...array];
            mezclarArray(arrayCopia);
            return arrayCopia.slice(0, cantidad);
        }
        
        // Funci√≥n para mezclar un array (algoritmo Fisher-Yates)
        function mezclarArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // Funci√≥n para verificar si una frase est√° en el orden correcto
        function verificarFrase(index) {
            const zonaDropId = `zona-drop-${index}`;
            const zonaDropElement = document.getElementById(zonaDropId);
            const palabrasEnZona = Array.from(zonaDropElement.children).map(el => el.textContent);
            
            // Obtener el √≠ndice real de la frase en el array global
            const fraseIndice = parseInt(document.getElementById(`frase-${index}`).dataset.fraseIndice);
            
            // Comprobamos si hay m√∫ltiples √≥rdenes correctos
            const ordenesCorrectos = frases[fraseIndice].ordenes_correctos || [frases[fraseIndice].orden_correcto];
            
            // Verificar si hay la misma cantidad de palabras en al menos una de las combinaciones posibles
            for (const ordenCorrecto of ordenesCorrectos) {
                if (palabrasEnZona.length !== ordenCorrecto.length) {
                    continue; // Si no coincide el tama√±o, prueba con la siguiente combinaci√≥n
                }
                
                // Verificar si est√°n en el orden correcto para esta combinaci√≥n
                let ordenCorrecto = true;
                for (let i = 0; i < ordenCorrecto.length; i++) {
                    if (palabrasEnZona[i] !== ordenCorrecto[i]) {
                        ordenCorrecto = false;
                        break;
                    }
                }
                
                if (ordenCorrecto) {
                    return true; // Encontramos una combinaci√≥n v√°lida
                }
            }
            
            return false; // Ninguna combinaci√≥n coincide
        }
        
        // Funci√≥n para verificar todas las frases
        function verificarTodas() {
            let nuevaPuntuacion = puntuacion;
            
            // Para cada frase en el contenedor
            for (let i = 0; i < nivelesConfig[nivelActual].totalFrases; i++) {
                // Si la frase ya est√° bloqueada (ya verificada en esta ronda), saltarla
                if (frasesBloqueadas.has(i)) {
                    continue;
                }
                
                const esCorrecta = verificarFrase(i);
                const resultadoElement = document.getElementById(`resultado-${i}`);
                resultadoElement.style.display = "block";
                
                if (esCorrecta) {
                    resultadoElement.textContent = "¬°Correcto!";
                    resultadoElement.className = "resultado correcto";
                    
                    // Solo sumar punto si no estaba bloqueada previamente
                    if (!frasesBloqueadas.has(i)) {
                        nuevaPuntuacion++;
                        puntuacionTotal++;
                    }
                    
                    // Marcar la frase como completada y bloqueada
                    const fraseIndice = parseInt(document.getElementById(`frase-${i}`).dataset.fraseIndice);
                    frasesCompletadas.add(fraseIndice);
                    frasesBloqueadas.add(i);
                    
                    // Marcar las palabras como correctas y bloquear la zona
                    const zonaDrop = document.getElementById(`zona-drop-${i}`);
                    zonaDrop.classList.add("correcta");
                    Array.from(zonaDrop.children).forEach(palabra => {
                        palabra.classList.add("correcta");
                    });
                    
                    // Animar la frase completada
                    document.getElementById(`frase-${i}`).classList.add("completada");
                } else {
                    resultadoElement.textContent = "¬°Incorrecto! Sigue intentando.";
                    resultadoElement.className = "resultado incorrecto";
                    
                    // Marcar palabras incorrectas/correctas si hay alguna palabra colocada
                    const zonaDrop = document.getElementById(`zona-drop-${i}`);
                    const fraseIndice = parseInt(document.getElementById(`frase-${i}`).dataset.fraseIndice);
                    const ordenCorrecto = frases[fraseIndice].orden_correcto;
                    
                    if (zonaDrop.children.length > 0) {
                        Array.from(zonaDrop.children).forEach((palabra, idx) => {
                            if (idx < ordenCorrecto.length && palabra.textContent === ordenCorrecto[idx]) {
                                palabra.classList.add("correcta");
                            } else {
                                palabra.classList.add("incorrecta");
                            }
                        });
                    }
                }
            }
            
            // Actualizar puntuaci√≥n solo si ha cambiado
            if (nuevaPuntuacion !== puntuacion) {
                puntuacion = nuevaPuntuacion;
                document.getElementById("puntos").textContent = puntuacion;
                
                // Actualizar estrellas
                actualizarEstrellas();
            }
            
            // Comprobar si se han completado todas las frases
            const todasCompletadas = Array.from({length: nivelesConfig[nivelActual].totalFrases}, (_, i) => i)
                .every(i => frasesBloqueadas.has(i));
                
            if (todasCompletadas) {
                setTimeout(() => {
                    if (confirm(`¬°Bien hecho, ${jugador}! Has completado todas las frases. ¬øQuieres pasar a una nueva ronda?`)) {
                        nuevaRonda();
                    }
                }, 1000);
            }
        }
        
        // Funci√≥n para actualizar las estrellas seg√∫n la puntuaci√≥n
        function actualizarEstrellas() {
            const config = nivelesConfig[nivelActual];
            
            // Calcular cu√°ntas estrellas debe tener activas
            const estrellasActivas = Math.min(5, Math.floor(puntuacionTotal / config.puntosParaEstrella));
            
            // Actualizar las estrellas en la UI
            for (let i = 1; i <= 5; i++) {
                const estrella = document.getElementById(`estrella-${i}`);
                if (i <= estrellasActivas) {
                    estrella.classList.add("activa");
                } else {
                    estrella.classList.remove("activa");
                }
            }
            
            // Actualizar nivel alcanzado
            const nivelActualUsuario = nivelesAlcanzados[Math.min(4, Math.floor(estrellasActivas / 2))];
            document.getElementById("nivel-alcanzado").textContent = `Nivel: ${nivelActualUsuario}`;
        }
        
        // Funci√≥n para iniciar una nueva ronda
        function nuevaRonda() {
            // Reiniciar puntuaci√≥n de la ronda
            puntuacion = 0;
            document.getElementById("puntos").textContent = puntuacion;
            
            // Borrar resultados previos
            document.querySelectorAll(".resultado").forEach(el => {
                el.style.display = "none";
                el.textContent = "";
            });
            
            // Generar nuevas frases
            generarFrases();
            
            // Mostrar nueva frase motivadora
            mostrarFraseMotivadora();
        }
        
        // Funciones para drag and drop
        let palabraArrastrada = null;
        
        function dragStart(e) {
            this.classList.add("arrastrando");
            palabraArrastrada = this;
            e.dataTransfer.setData("text/plain", this.textContent); // Guarda el texto para compatibilidad
            e.dataTransfer.effectAllowed = "move";
        }
        
        function dragEnd() {
            this.classList.remove("arrastrando");
        }
        
        function dragOver(e) {
            e.preventDefault(); // Necesario para permitir soltar
            e.dataTransfer.dropEffect = "move";
        }
        
        function dragEnter(e) {
            e.preventDefault();
            this.style.backgroundColor = "#f0f8ff"; // Color cuando se arrastra sobre la zona
        }
        
        function dragLeave() {
            this.style.backgroundColor = "white"; // Volver al color original
        }
        
        function drop(e) {
            e.preventDefault();
            this.style.backgroundColor = "white"; // Restaurar color original
            
            // Si la zona est√° marcada como correcta, no hacer nada
            if (this.classList.contains("correcta")) {
                return;
            }
            
            if (palabraArrastrada) {
                const fraseIndex = parseInt(this.dataset.index);
                
                // Determinar la posici√≥n donde soltar la palabra basada en la posici√≥n del rat√≥n
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                
                // Encontrar el elemento antes del cual insertar la palabra
                let anteriorElemento = null;
                const palabrasEnZona = Array.from(this.children);
                
                for (const palabra of palabrasEnZona) {
                    const palabraRect = palabra.getBoundingClientRect();
                    const palabraCentro = palabraRect.left + palabraRect.width / 2 - rect.left;
                    
                    if (x < palabraCentro) {
                        anteriorElemento = palabra;
                        break;
                    }
                }
                
                // Si la palabra ya estaba en una zona drop, moverla
                if (palabraArrastrada.parentElement.classList.contains("zona-drop")) {
                    // Insertar antes del elemento encontrado o al final si es null
                    if (anteriorElemento) {
                        this.insertBefore(palabraArrastrada, anteriorElemento);
                    } else {
                        this.appendChild(palabraArrastrada);
                    }
                    
                    // Mantener la clase palabra-colocada
                    palabraArrastrada.classList.add("palabra-colocada");
                } else {
                    // Crear un clon de la palabra y a√±adirlo a la zona drop
                    const clonPalabra = palabraArrastrada.cloneNode(true);
                    clonPalabra.addEventListener("click", clickPalabraEnZona);
                    clonPalabra.addEventListener("dragstart", dragStart);
                    clonPalabra.addEventListener("dragend", dragEnd);
                    clonPalabra.classList.add("palabra-colocada");
                    
                    // Insertar en la posici√≥n correcta
                    if (anteriorElemento) {
                        this.insertBefore(clonPalabra, anteriorElemento);
                    } else {
                        this.appendChild(clonPalabra);
                    }
                    
                    // Ocultar la palabra original
                    palabraArrastrada.style.display = "none";
                }
                
                // Quitar cualquier clase de correcto/incorrecto anterior
                Array.from(this.children).forEach(p => {
                    p.classList.remove("correcta", "incorrecta");
                });
                
                // Quitar cualquier mensaje de resultado
                const resultadoEl = document.getElementById(`resultado-${fraseIndex}`);
                resultadoEl.style.display = "none";
                
                palabraArrastrada = null;
            }
        }
        
        // Funciones para el manejo de clicks (para dispositivos m√≥viles)
        function clickPalabra() {
            // Si la zona est√° marcada como correcta, no hacer nada
            const fraseIndex = this.dataset.index;
            const zonaDestino = document.getElementById(`zona-drop-${fraseIndex}`);
            
            if (zonaDestino.classList.contains("correcta")) {
                return;
            }
            
            // Crear un clon de la palabra y a√±adirlo a la zona drop
            const clonPalabra = this.cloneNode(true);
            clonPalabra.addEventListener("click", clickPalabraEnZona);
            clonPalabra.addEventListener("dragstart", dragStart); // Agregar evento drag a la palabra clonada
            clonPalabra.addEventListener("dragend", dragEnd);     // Agregar evento dragend
            clonPalabra.draggable = true;                         // Asegurar que sea arrastrable
            clonPalabra.classList.add("palabra-colocada");
            zonaDestino.appendChild(clonPalabra);
            
            // Ocultar la palabra original
            this.style.display = "none";
            
            // Quitar cualquier clase de correcto/incorrecto anterior
            Array.from(zonaDestino.children).forEach(p => {
                p.classList.remove("correcta", "incorrecta");
            });
            
            // Quitar cualquier mensaje de resultado
            const resultadoEl = document.getElementById(`resultado-${fraseIndex}`);
            resultadoEl.style.display = "none";
        }
        
        function clickPalabraEnZona() {
            // Si la zona est√° marcada como correcta, no hacer nada
            if (this.parentElement.classList.contains("correcta")) {
                return;
            }
            
            // Al hacer click en una palabra dentro de la zona drop, la devolvemos
            const fraseIndex = this.dataset.index;
            const palabrasOriginales = document.getElementById(`palabras-${fraseIndex}`);
            
            // Buscar la palabra original y mostrarla
            Array.from(palabrasOriginales.children).forEach(palabra => {
                if (palabra.textContent === this.textContent && palabra.style.display === "none") {
                    palabra.style.display = "inline-block";
                    return; // Salir del forEach despu√©s de encontrarla
                }
            });
            
            // Eliminar el clon de la zona drop
            this.remove();
            
            // Quitar cualquier mensaje de resultado
            const resultadoEl = document.getElementById(`resultado-${fraseIndex}`);
            resultadoEl.style.display = "none";
        }
        
        function clickZonaDestino() {
            // Esta funci√≥n se utiliza para seleccionar una zona al hacer clic
            // No es necesaria una implementaci√≥n espec√≠fica en este caso
        }
    </script>
</body>
</html>
